#+latex_class: cn-article
#+title: ET 框架拖拉机项目试改装
#+author: deepwaterooo 

* ET 框架 demo 的正常运行
- 本ET 框架拖拉机项目：基于ET框架。请先能正常运行ET的demo
- 以前的几个游戏，不知道是不是两三个月前的ET 框架，我有运行通过，就是鼠标点击，可以引导地图上小人的快速转位到鼠标点击位置。但不是狠记得：究竟是斗地主游戏的，还是最新的 ET 框架的，还是某些版本ET 的，比如 ET-EUI? 现在因为要套用ET 框架，就必须得保证它的示例程序，能够正常运行得通了。有个拦路的 HybridCLR, 不知道是否得重装 Visual-studio 2019 C++ 版本？太坑人了. 更多的感觉，像是后来补出来的 bug, 专门堵人的。。。但是应该能够想办法把这个问题解决掉。再不行，就换个分支用。
- 【ET 框架运行：】HybridCLR 热更新依赖，需要添加安装上。 
  
[[./pic/readme_20230509_160417.png]]

* 介绍： 
- 一款双副牌80 分拖拉机游戏,基于ET框架开发,基本和市面上的,房卡拖拉机一样,功能基本实现 有匹配模式,房卡模式 录像功能 亲友圈  
- 感觉对ET 的这个框架现在吃得还比较透彻了，但是具体游戏里，【可能主要是因为今天，我所读的源码，只限于几年前的这个卡五星的游戏源码】，所以部分源码仍然还没能跟上。比如网关服与地图服游戏服的申请连接等，现在源码里还没能跟上。但感觉从ET 7.2 里应该是能够狠容易找到的。这个现卡五星几年前的框架源码还是相对落后的。截个图，作个记号在这里
  
[[./pic/readme_20230508_172732.png]]

* 双副牌双升108 张卡牌游戏 
- 昨天晚上找见了别人几年前就开发出来的卡五星麻将，所以写麻将游戏的想法就被恶杀在摇篮中。现在再写什么好呢？就只能写【双升拖拉机】了，就是两副牌108 张来打的拖拉机。现已经 ios iPhone 上有的双升游戏，可能搜索一下设计，写安卓版的双升了，看下能否套用ET 框架，写成四人网络【客户端与服务器双热更新的】网络游戏
- 现在先搜索必要的框架设计，出版规则比大小算法之类的。
- 【服务器与客户端的同步】：尤其是在分四人牌后，亮主拖底的时候，谁先亮，亮什么主，顺序重要，结果重要。【 ET 框架有专用的游戏服，由游戏服来状态同步】在本程序中，采用的是服务器保存所有的状态，处理所有的逻辑。比如，客户端在点击亮主后，做的事情就是发一个消息给服务器，不做任何显示操作，等待服务器传来亮主的消息后再显示
  - 【发牌，公正性】：随机分牌。第一步就是要发牌。需要做到一个完全随机的发牌，就要保证每张牌发到每个玩家手里的概率都是一样的，而且牌的顺序是等概率随机打乱的。程序中采用的是如下的发牌算法（感谢Dr.Light提供）：假如有两幅牌，编号从1到108，首先随机选出一个，并且将牌发给玩家，然后将这个编号的牌与108号牌交换编号，那么剩下的牌就是从1到107号。于是再从中选出一个，重复以上的过程，这样一来，算法的复杂度就是O(n)。
- 【牌的逻辑OOD/OOP】设计：三个类，对应单张，拖拉机（对子是长度为1 的拖拉机），和混合单张与拖拉机，如下图
  
[[./pic/plan_20230508_213616.png]]

- 第一手牌与非第一手牌的处理：
  
[[./pic/plan_20230508_223827.png]]

- 参考一个很Q 的界面：
  
[[./pic/plan_20230508_222717.png]]

[[./pic/plan_20230508_221732.png]]
- 亮着牌打的不好玩，一定会把其它三副牌藏起来的
- http://www.homygame.com/ngscom/help/shengji.htm  
- 简易版设计原理：模拟拖拉机（升级）玩法；
  - 1.创建两副牌的集合：HashMap
  - 2.创建纸牌：四个花色共108张♦ ♣ ♥ ♠
  - 3.创建poker的ArrayList操作集合
  - 4.创建亮主牌的操作
  - 5.将所有牌放入牌盒中
  - 6.创建四个玩家与底牌的集合：HashSet wj1,wj2,wj3,wj4,dipai
  - 7.洗牌
  - 8.发牌操作
  - 9.创建看牌方法
  - 10.调用方法看牌
- 安桌上的游戏现在是这样的：还要再写一个吗？【活宝妹就是一定要嫁给亲爱的表哥！！！】还是说更为完善或是好玩儿的游戏逻辑？或是UI 视图画面，或是性能表现？反正一定是套用ET 框架写得最容易快速方便。【感觉现在这个截图的UI 长得有点儿丑怪。。】不好看不经典，看了就不想玩儿了。。
* 主要参考项目：
- 【ET- 斗地主游戏】年代久远，ET 框架的版本古旧。手游风格的界面设计
- 【ET- 卡五星游戏】年代久远，ET 框架的版本古旧。主要看牌类相关的房间内的逻辑
- 分支 7.2 与主分支的区别：都有最开始必须取消主相机。区别是进入地图时，7.2 如果再激活相机，可以看见地图，小人也能跟随鼠标右键动。主分支可能还需要我再看一下，为什么主分支进入不了地图。两个分支对比一下，主要是让自己放心，现所使用的主分支应该没有 blocking 【BUG：】存在。去看下主分支，可以显示地图吗
* 项目主要进展
- 因为两个参考项目的版本都狠古旧，现用最新版本的ET 【我觉得这里，最好我还是先去试ET7.2 官方版本可能更好】就以自己能有的相对快速，按照现有的理解，把能重组的重组出来。不理解的，再去看下两个项目分别的实现逻辑。

